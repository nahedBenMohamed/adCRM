{% extends 'baseTeacher.html.twig' %}
{% block title %}
    Ajouter une formation
{% endblock %}
{% block stylesheets %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css" rel="stylesheet"/>
    <style>
        body {padding-top: 60px;}
        #formation_form_lieuFormation label, #formation_form_linkType label {
            padding: 10px
        }
        .tox-tinymce {
            height: 350px;
        }
        .hidden {
            display: none;
        }
        .custom-file-upload {
            cursor: pointer;
        }
        #trainee-table th {
            background: #132438;
            color: #fff;
        }
        .list-btn {
            justify-content: flex-end;
        }
        .td-action {
            display: flex;
            justify-content: flex-end;
        }
        #tableClient .td-action {
            display: table-cell;
        }
        .bloc-add {
            display: inline-flex;
            width: 95%;
            flex-wrap: nowrap;
        }
        .bloc-add a {
            padding-left: 0;
            padding-top: 4px;
        }
        #link-formator {
            border: 1px solid #ccc;
            border-radius: 7px;
            color: blue;
            display: block;
            width: 100%;
            padding: .375rem .75rem;
            font-size: 1rem;
            line-height: 1.5;
            margin: 0px;
        }
        .custom-link {
            float: right;
            padding: 20px 7px 15px 0;
            color: #012970;
            font-size: 13px;
            text-decoration: underline;
        }
        .datatable-pagination-list button {
            color: #012970;
        }
        label {
            color: #847e7e;
        }
        .td-links {
            min-width: 200px;
        }
        .td-action-trainer {
            min-width: 140px;
        }
        td.td-action-trainer a {
            margin-left: 3px;
        }
    </style>
{% endblock %}
{% block body %}
    <section class="section" style="margin-top: -75px;">
        <div id="loader" class="loader-overlay" style="display: none">
            <div class="loader"></div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <h3 class="card-title">
                    D√©tails de la formation {{ courseName }}
                </h3>
            </div>
        </div>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item " role="presentation">
                <button class="nav-link active" id="tab-1" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="false">
                    Informations g√©n√©rales
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-2"  data-bs-toggle="tab" data-bs-target="#stagiaires" type="button" role="tab" aria-controls="stagiaires" aria-selected="false">Stagiaires</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-3" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab" aria-controls="info" aria-selected="false">Info Formation</button>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade active show  tab1" id="details" role="tabpanel" aria-labelledby="tab-1">
                <div class="card">
                    <div class="card-body">
                        <p>‚úÖ <b>Modalit√©:</b> {{ formation.lieuFormation }}</p>
                        <p>üìÖ <b>Dates et horaires:</b>  {{ formation.timesheet|striptags|raw }}</p>
                        {% if (formation.lieuFormation == 'Pr√©sentiel') %}
                            <p>üìç <b>Lieu de formation:</b> {{ formation.formationAddress|striptags|raw }}</p>
                        {% elseif (formation.lieuFormation == 'Distanciel')%}
                            <p>üé• <b>Lien de classe virtuelle:</b>
                                {% if (formation.formateur is defined and formation.formateur.linkFormateur) %}
                                    <a href="{{  formation.formateur.linkFormateur  }}" target="_blank"  class="bleu-link "> {{  formation.formateur.linkFormateur }}</a>
                                {% else %}
                                    <a href="{{ formation.lienFormation }}" target="_blank"  class="bleu-link "> {{ formation.lienFormation }}</a>
                                {% endif %}
                            </p>
                        {% else %}
                            <p>üìç <b>Lieu de formation:</b> {{ formation.formationAddress|striptags|raw }}</p>
                            <p>üé• <b>Lien de connexion √† votre classe virtuelle :</b>
                                {% if (formation.formateur is defined and formation.formateur.linkFormateur) %}
                                    <a href="{{  formation.formateur.linkFormateur  }}" target="_blank"  class="bleu-link "> {{  formation.formateur.linkFormateur }}</a>
                                {% else %}
                                    <a href="{{ formation.lienFormation }}" target="_blank" class="bleu-link "> {{ formation.lienFormation }}</a>
                                {% endif %}
                            </p>
                        {% endif %}
                        <p><b>Date de d√©but:</b> {{ formation.dateDebutFormation|date }}</p>
                        <p><b>Date de fin:</b> {{ formation.dateFinFormation|date }}</p>
                        <p><b>Nombre total d'heures:</b> {{ formation.dureeFormation }}</p>
                        {% if  formation.linkToProgram is defined and formation.linkToProgram is not null%}
                        <p><b>Lien vers le programme:</b> <a href="{{ formation.linkToProgram.value }}"  target="_blank"  class="bleu-link ">{{ formation.linkToProgram.name }}</a> </p>
                        {% endif %}
                        {% if  formation.linkToLivretAccueil is defined and formation.linkToLivretAccueil is not null%}
                        <p><b>Lien vers le livret d'accueil:</b> <a href="{{ formation.linkToLivretAccueil.value }}"  target="_blank"  class="bleu-link ">{{ formation.linkToLivretAccueil.name }}</a> </p>
                        {% endif %}
                        {% if  formation.linkGuide is defined and formation.linkGuide is not null%}
                        <p><b>Guide de votre classe virtuelle:</b> <a href="{{ formation.linkGuide.value }}"  target="_blank"  class="bleu-link ">{{ formation.linkGuide.name }}</a> </p>
                        {% endif %}
                        {% if  formation.linkFormulaire is defined and formation.linkFormulaire is not null%}
                        <p><b>Formulaire de recueil des attentes:</b> <a href="{{ formation.linkFormulaire.value }}"  target="_blank"  class="bleu-link ">{{ formation.linkFormulaire.name }}</a> </p>
                        {% endif %}
                        <b>Objectifs de l'action de formation:</b>
                            <div class="training-objectives">
                            {{ formation.objective|raw }}
                        </div>

                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="stagiaires" role="tabpanel" aria-labelledby="tab-2">
                <div class="card">
                    {% if formation is defined %}
                        <div class="card">
                            <div class="card-body ps-0 pe-0">
                                <div class="ml-2 mr-2 m-lg-3">
                                    <div class="row mb-3">
                                        <div class="col-sm-6">
                                            <select class="js-example-basic-single selectTrainee" name="selectTrainee" data-formationId="{{ formation.id }}" data-url="{{path('app_affect_trainee')}}" style="width: 100%">
                                                <option selected="" value="0">Choisir un stagaire de la liste</option>
                                                {% for trainee in allTrainees %}
                                                    <option value="{{ trainee.id }}">{{ trainee.firstName }} {{ trainee.lastName }} / {{ trainee.email }}</option>
                                                {% endfor %}
                                            </select>
                                            <div class="add-stag-alert mt-2">
                                            </div>
                                        </div>
                                        <div class="col-sm-3 offset-md-3 d-inline-flex list-btn">
                                            <div class="mx-lg-2">
                                                <a href="{{path('app_add_trainee',{ 'formationId': formation.id })}}" title="Ajouter Stagiaire √† la formation"> <img src="{{asset('assets/img/icon/user-plus-solid.svg')}}" width="40"></a>
                                            </div>
                                            <div class="mx-lg-2">
                                                <a href="{{path('app_download_trainee_by_formation',{'idFormation': formation.id })}}" title="T√©lecharger stagiaires" class="float-end mt-4 mb-4" style="display: contents">
                                                    <img src="{{asset('assets/img/icon/file-arrow-down-solid.svg')}}" width="30" class="float-end new_Btn">
                                                </a>
                                            </div>
                                            <div class="mx-lg-2 hidden">
                                                <a href="{{path('app_download_certif_attestation',{'idFormation': formation.id })}}" title="T√©lecharger Attestations et certificats" class="float-end mt-4 mb-4" style="display: contents">
                                                    <img src="{{asset('assets/img/icon/download-solid.svg')}}" width="25" class="float-end">
                                                </a>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="row hidden">
                                        <div class="col-md-6"> <h5 class="card-title">
                                                {% if trainees|length == 1 %}
                                                    {{ trainees|length }} stagaire inscrit
                                                {% else%}
                                                    {{ trainees|length }} stagaires inscrits
                                                {% endif %}
                                            </h5>
                                        </div>
                                    </div>
                                </div>

                                <table class="table table-striped" id="trainee-table">
                                    <thead>
                                    <tr>
                                        <th scope="col">Nom</th>
                                        <th scope="col">Pr√©nom</th>
                                        <th scope="col">Fonction</th>
                                        <th scope="col">Email</th>
                                        <th>
                                        </th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for stg in trainees %}
                                        {% if stg is not null %}
                                            <tr {% if stg.sendConvocation == '1' %} class="success-send-mail" {% endif %}>
                                                <td>{{ stg.trainee.firstName }}</td>
                                                <td>{{ stg.trainee.lastName }}</td>
                                                <td>{{ stg.trainee.position }}</td>
                                                <td>{{ stg.trainee.email }}</td>
                                                <td class="td-links">
                                                    <a href="{{ path('app_trainee_see_attestation', { 'idFormation':formation.id, 'idTrainee': stg.trainee.id }) }}" class="" title="Voir attestation" class="" target="_blank">
                                                        Attestation
                                                    </a>
                                                    <a href="{{path('app_download_attestation_tr',{'idFormation': formation.id,'idTrainee': stg.trainee.id })}}" title="T√©lecharger Attestation" class="">
                                                        <img src="{{asset('assets/img/icon/download-solid.svg')}}" width="10">
                                                    </a>
                                                    <a href="{{ path('app_trainee_see_certif', { 'idFormation':formation.id, 'idTrainee': stg.trainee.id }) }}" class="" title="Voir Certificat" class="" target="_blank">
                                                        Certificat
                                                    </a>
                                                    <a href="{{path('app_download_certif_tr',{'idFormation': formation.id,'idTrainee': stg.trainee.id })}}" title="T√©lecharger Certificat" class="">
                                                        <img src="{{asset('assets/img/icon/download-solid.svg')}}" width="10">
                                                    </a>
                                                </td>
                                                <td class="td-action-trainer">
                                                    <a href="" data-bs-toggle="modal" data-bs-target="#updateTime" class="updateNbhour" title="Nombre d'heure {{ stg.nbHour }}" data-nbHour="{{ stg.nbHour }}" data-add-time-url="{{path('app_update_time',{ 'id': stg.trainee.id, 'formationId' : idFormation })}}">
                                                        <img src="{{asset('assets/img/icon/clock-solid.svg')}}">
                                                    </a>
                                                    <a href="{{ path('app_edit_trainee', { 'id':stg.trainee.id, 'idFormation':formation.id }) }}" class="" title="modifier">
                                                        <img src="{{asset('assets/img/icon/pen-solid.svg')}}">
                                                    </a>
                                                    <a href="{{ path('app_trainee_send_conv', { 'idFormation':formation.id, 'idTrainee': stg.trainee.id }) }}" class="" title="Envoyer convocation" class="">
                                                        <img src="{{asset('assets/img/icon/envelope-solid.svg')}}">
                                                    </a>
                                                    <a href="{{ path('app_trainee_see_conv', { 'idFormation':formation.id, 'idTrainee': stg.trainee.id }) }}" class="" title="Voir convocation" class="" target="_blank">
                                                        <img src="{{asset('assets/img/icon/eye-solid.svg')}}">
                                                    </a>
                                                    <a href="{{ path('app_trainee_formation_delete', { 'idFormation':formation.id, 'idTrainee': stg.trainee.id }) }}" class="" title="supprimer">
                                                        <img src="{{asset('assets/img/icon/circle-delete-solid-red.svg')}}">
                                                    </a>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="tab-pane fade" id="info" role="tabpanel" aria-labelledby="tab-3">
                <div class="card">
                    <div class="card-body">
                        <div class="card">
                            <div class="card-body">
                                {{ formation.infoFormateur|raw }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="modal fade" id="updateTime" tabindex="-1" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Introduire le nombre d'heure </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="number" name="numberHour" id="nomberHourStudent" class="form-control" placeholder="Nombre d'heure de pr√©sence">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" aria-label="Close">Annuler</button>
                    <button type="button" class="btn btn-primary updateNumberhour">Valider</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script>
        jQuery(document).ready(function() {
            $('#formation_form_linkType label:first').addClass('hidden');
            $('#formation_form_linkType input:first').addClass('hidden');
            $('.checkboxLieu input[type="radio"]:checked').each(function (e){
                if(this.value == 'Distanciel') {
                    $('.lieuFormation').addClass('hidden');
                    $('.linkType').removeClass('hidden');
                    $('.linkGuidFiled').removeClass('hidden');
                } else if(this.value == 'Pr√©sentiel') {
                    $('.lieuFormation').removeClass('hidden');
                    $('.linkType').addClass('hidden');
                    $('.teacher').addClass('hidden');
                    $('.linkVirFormation').addClass('hidden');
                    $('.linkGuidFiled').removeClass('hidden');
                }else if(this.value == 'Mixte') {
                    $('.lieuFormation').removeClass('hidden');
                    $('.linkType').removeClass('hidden');
                    $('.linkGuidFiled').removeClass('hidden');
                }
            });
            $('.linkType input[type="radio"]:checked').each(function (e){
                if(this.value == "LienBBB") {
                    $('.teacher').removeClass('hidden');
                    $('.linkVirFormation').addClass('hidden');
                } else if (this.value == "Lienexterne") {
                    $('.teacher').addClass('hidden');
                    $('.linkVirFormation').removeClass('hidden');
                }
            });
            $('input[type="radio"]').on('change', function(e) {
                if(this.value == 'Distanciel') {
                    $('.lieuFormation').addClass('hidden');
                    $('.linkType').removeClass('hidden');
                    $('.linkGuidFiled').removeClass('hidden');
                } else if(this.value == 'Pr√©sentiel') {
                    $('.lieuFormation').removeClass('hidden');
                    $('.linkType').addClass('hidden');
                    $('.linkGuidFiled').addClass('hidden');
                }else if(this.value == 'Mixte') {
                    $('.lieuFormation').removeClass('hidden');
                    $('.linkType').removeClass('hidden');
                    $('.linkGuidFiled').removeClass('hidden');
                }

                if(this.value == 'LienBBB') {
                    $('.teacher').removeClass('hidden');
                    $('.linkVirFormation').addClass('hidden');
                }
                if(this.value == 'Lienexterne') {
                    $('.teacher').addClass('hidden');
                    $('.linkVirFormation').removeClass('hidden');
                }
            });
            tinyMCE.init({
                height : "300",
                language: 'fr_FR',
                language_url : '/assets/vendor/tinymce/langs/fr_FR.js',
                menubar: false,
                branding: false,
                statusbar: false
            });
            tinymce.init({
                selector: 'textarea.addr-form',
                height : "150",
                language: 'fr_FR',
                language_url : '/assets/vendor/tinymce/langs/fr_FR.js',
                menubar: false,
                branding: false,
                statusbar: false
            });
            $('.js-datepicker').datepicker({
                format: 'dd/mm/yyyy',
                language: "fr",
                autoclose: true,
                orientation: "bottom left",
                minDate: new Date()
            });
            /*setTimeout(function(){
                $('.tox-menubar, .tox-promotion, .tox-statusbar').css('display','none');
            }, 1000);*/

            //hide statique link
            $('#formation_form_linkToProgram option').each(function (e){
                if(this.text.includes('##')) {
                    this.style.display = "none";
                } else {
                    this.style.display = "block";
                }
            });

            $('#formation_form_linkFormateur option').each(function (e){
                if(this.text.includes('##')) {
                    this.style.display = "none";
                } else {
                    this.style.display = "block";
                }
            });

            $('#formation_form_linkToLivretAccueil option').each(function (e){
                if(this.text.includes('lien statique')) {
                    this.style.display = "none";
                } else {
                    this.style.display = "block";
                }
            });
            $('#formation_form_linkGuide option').each(function (e){
                if(this.text.includes('lien statique')) {
                    this.style.display = "none";
                } else {
                    this.style.display = "block";
                }
            });

            $('#formation_form_linkFormulaire option').each(function (e){
                if(this.text.includes('lien statique')) {
                    this.style.display = "none";
                } else {
                    this.style.display = "block";
                }
            });

            $('#add-program').on('click', function (e) {
                e.preventDefault();
                $('#otherProgram').removeClass('hidden');
            })
            var linkPr =  $('#formation_form_linkToProgram :selected').text().split('##');
            if(linkPr.length === 2) {
                $('#add-program').trigger('click');
                document.getElementById("staticValueProgramm").value =linkPr[0];
                document.getElementById('formation_form_linkToProgram').value = ''
            }

            var linkFormator =  $('#formation_form_linkFormateur :selected').text().split('##');
            if(linkFormator.length === 2) {
                $('#otherLinkFormateur').removeClass('hidden');
                document.getElementById("inputOtherLinkFormateur").value =linkFormator[0];
                document.getElementById('formation_form_linkFormateur').value = ''
            }

            $('#add-linkFormateur').on('click', function (e) {
                e.preventDefault();
                $('#otherLinkFormateur').removeClass('hidden');
            })

            $('.js-example-basic-single').select2();
            $('.selectTrainee').on('change',function () {
                let selecedItem = $(".selectTrainee :selected").val()
                let addTrainee = $(this).attr('data-url');
                let formationId = $(this).attr('data-formationId');
                $('.add-stag-alert').html('')
                if(parseInt(selecedItem) !== 0) {
                    $.ajax({
                        url: addTrainee,
                        type: 'POST',
                        data: {'selecedItem': selecedItem, 'formationId': formationId},
                        success: function(data)
                        {
                            if(data !== false) {
                                let newData = JSON.parse(data);
                                if(newData && newData.status == true) {
                                    let deleteLink = '/courses/deleteTrainee/'+formationId+'/'+newData.id;
                                    let updateLInk = '/trainee/edit/'+newData.id+'/'+formationId;
                                    let sendMailLInk = '/courses/sendConvocation/'+formationId+'/'+newData.id;
                                    let seePdfLink = '/courses/seeConvocation/'+formationId+'/'+newData.id;
                                    $('#trainee-table').find('tbody').append("<tr><td>"+newData.firstName+"</td><td>"+newData.lastName+"</td><td>"+newData.position+"</td><td>"+newData.email+"</td>" +
                                        "<td class='td-links'></td><td class='td-action-trainer'>  <a href='"+updateLInk+"' class='first-btn' title='modifier'>" +
                                        "<img src='/assets/img/icon/pen-solid.svg'></a>" +
                                        "<a href='"+sendMailLInk+"' class='first-btn' title='Envoyer convocation'>" +
                                        "<img src='/assets/img/icon/envelope-solid.svg'></a>"+
                                        "<a href='"+seePdfLink+"' class='first-btn' title='Voir convocation' target='_blank'>"+
                                        "<img src='/assets/img/icon/eye-solid.svg'></a>"+
                                        "<a href='"+ deleteLink+"' class='first-btn' title='supprimer'>" +
                                        "<img src='/assets/img/icon/circle-delete-solid-red.svg'></a></td></tr>");
                                    $('.send-conv').removeClass('hidden');
                                } else {
                                    //show alert exist already
                                    $('.add-stag-alert').append('<div class="alert alert-danger alert-dismissible fade show" role="alert"> ' +
                                        newData.message+
                                        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> ' +
                                        '</div>');
                                }

                            }
                        }
                    });
                }

            })
            $('.new_Btn').click(function() {
                $('#html_btn').click();
            });
            $('#html_btn').change(function(){
                //submit the form here
                $('#importFile').submit();
            });
            $('#add-program').on('click', function (e) {
                e.preventDefault();
                $('#otherProgram').removeClass('hidden');
            })

            $('#formation_form_formateur option:selected').each(function (e){
                if ($(this).attr("data-link") !== undefined && $(this).attr("data-link").length > 0 ) {
                    $('#link-formator').text($(this).attr("data-link"));
                } else {
                    $('#link-formator').text('Aucun lien s√©lectionn√©');
                }
            });
            $('#formation_form_formateur').on('change',function (event) {
                var select = event.target;
                var selectedOption = select.options[select.selectedIndex];
                var name = selectedOption.getAttribute('data-link');
                if(name !== '') {
                    $('#link-formator').text(name);
                } else {
                    $('#link-formator').text('Aucun lien s√©lectionn√©');
                }

            });
            let tabClient = [];
            $('.selectClient').on('change',function () {
                let selecedItem = $(".selectClient :selected").val();
                console.log(selecedItem)
                //let addTrainee = $(this).attr('data-url');
                if(parseInt(selecedItem) !== 0) {
                    tabClient[0] = selecedItem;
                    // tabClient.push(parseInt(selecedItem))
                    // $('#selectedClientItem').append('<li>'+ $(".selectClient :selected").text()+'</li>');
                }
            });
            $('#create-formation-interne').on('click', function () {
                //save client for the new formations
                let addCustomer = $(this).attr('data-url');
                let formationId = $(this).attr('data-formationId');
                let typeFormation = "intra";
                if (tabClient.length > 0) {
                    $.ajax({
                        url: addCustomer,
                        type: 'POST',
                        data: {'selectedItems': JSON.stringify(tabClient), 'formationId': formationId, 'typeFormation' : typeFormation},
                        success: function(data)
                        {
                            window.location.href = '/courses/courseManagement/'+typeFormation+'/'+data;
                        }
                    });
                }
            })
        });
        /*const datatable = document.getElementById('tableClient');
        new simpleDatatables.DataTable(datatable, {
            perPage: 5,
            sDom: 'Rfrtlip',
            dom: '<"top"f>rt<"bottom"ilp><"clear">'
        });*/
        $('.updateNbhour').on('click', function () {
            let updatetTimeURl = $(this).attr('data-add-time-url');
            $('.updateNumberhour').attr('data-updateNumberhour', updatetTimeURl);
            let nbHourForCurrentTR = $(this).attr('data-nbHour');
            $('#nomberHourStudent').val(nbHourForCurrentTR);
        });
        $(".updateNumberhour").click(function () {
            let updatetTimeURl = $(this).attr('data-updateNumberhour');
            let nbHour = parseInt($('#nomberHourStudent').val());
            $.ajax({
                url: updatetTimeURl,
                type: 'POST',
                data: {'nbHour':nbHour},
                success: function(data)
                {
                    let newData = JSON.parse(data);
                    if(newData) {
                        $('#updateTime').modal('hide');
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                    }
                    window.location.reload()
                },
                error: function(jqXHR){
                }
            });
        });
        tinymce.init({
            selector: '#evaluationChaud',
            plugins: 'lists link image', // Only add essential plugins
            toolbar: 'bold italic | alignleft aligncenter alignright | bullist numlist'
        });
        $('#submit-eval-chaud').on('click', function () {
            $('.loader-overlay').css('display','flex')
            let urlEvalChaud = $(this).attr('data-url');
            let formationId = $(this).attr('data-formationId');
            let subject = $('#subjectEvalChaud').val();
            // Get content from TinyMCE editor
            const content = tinymce.get('evaluationChaud').getContent();
            if(formationId) {
                $.ajax({
                    url: urlEvalChaud,
                    type: 'POST',
                    data: {'subject': subject,'text': content, 'formationId': formationId},
                    success: function(data)
                    {
                        $('.loader-overlay').css('display','none')
                        window.location.reload()
                    }
                });
            }
        })
        tinymce.init({
            selector: '#evaluationFroid',
            plugins: 'lists link image', // Only add essential plugins
            toolbar: 'bold italic | alignleft aligncenter alignright | bullist numlist'
        });
        $('#submit-eval-froid').on('click', function () {
            $('.loader-overlay').css('display','flex')
            let urlEvalFroid = $(this).attr('data-url');
            let formationId = $(this).attr('data-formationId');
            let subject = $('#subjectEvalFroid').val();
            const content = tinymce.get('evaluationFroid').getContent();
            if(formationId) {
                $.ajax({
                    url: urlEvalFroid,
                    type: 'POST',
                    data: {'subject': subject,'text': content, 'formationId': formationId},
                    success: function(data)
                    {  $('.loader-overlay').css('display','none')
                        window.location.reload()
                    }
                });
            }
        })
        $(".btn-save").on("click", function(event) {
            // Show the loader
            console.log(this.checkValidity())
            $('.loader-overlay').css('display','flex')
        });
    </script>
{% endblock %}
